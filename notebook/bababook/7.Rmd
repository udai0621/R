---
title: "7章　RによるARIMAモデル"
output: html_document
---
```{r}
library(forecast)
library(tseries)
library(ggplot2)
library(ggfortify)
theme_set(theme_bw(base_family = "HiraKakuProN-W3"))
```
#### 7-2.分析の対象
- Seatsbeltsを使用
  - front：前席における死傷者数
  - PetrolPrice：ガソリンの値段
  - law：前席においてシートベルトの義務付け法案の有無。1983年1月31日に施行。
```{r}
front <- Seatbelts[, "front"]
```

- このデータに関しては、モデルが複雑になる。
  - 季節成分が必須。毎年12月頃に死傷者数が増加している。
  - ガソリンの値段が高いと車にあまり乗らなくなり、交通事故死傷者数が減ると考えられる。
  - シートベルト法案も交通事故死傷者数を減らす効果がある。
- 以上より、季節成分＋外生変数の入ったARIMAモデル、「SARIMAX」を使う。

#### 対数変換
- 個数や人数といったデータは対数変換してからモデル化するとうまくモデル化できる傾向がある。
```{r}
# 対数系列
log_front <- log(front)

# 図示
ggtsdisplay(log_front, main = "対数系列")
```
#### 7-4.差分系列の作成方法
```{r}
# 原系列
front

# ラグをとる
lag(front, -1)
```

```{r}
# ラグをとったデータを原系列から引くことで差分系列が手に入る
front - lag(front, -1)
```

```{r}
# diffで行うことも可能
diff(front, lag = 1)
```
```{r}
# 対数差分系列
log_diff <- diff(log_front)

# 図示
ggtsdisplay(log_diff, main = "対数差分系列")
```

#### 7-5.季節成分の取り扱い
```{r}
# 月ごとに分けたグラフを図示
ggsubseriesplot(front)
```

```{r}
# 季節差分を取得
frequency(front)

diff(front, lag = frequency(front))
```
```{r}
# 対数差分系列にさらに季節差分をとる
season_log_diff <- diff(log_diff, lag = frequency(log_diff))

# 図示
ggtsdisplay(season_log_diff, main = "季節差分系列")
```
#### 7-6.自己相関とコレログラム
```{r}
# 自己相関を数値で得る
acf(season_log_diff, plot = F, lag.max = 12)
```
#### 7-7.訓練データとテストデータに分ける
- あらかじめ対数変換はしておく
- 差分系列は、ARIMAが勝手に差分をとってくれるため、行わない。

```{r}

```

