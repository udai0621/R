<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6章Rによる時系列の取り扱い</title>
  <meta name="description" content="6章Rによる時系列の取り扱い" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6章Rによる時系列の取り扱い" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6章Rによる時系列の取り扱い" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">


      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">6章Rによる時系列の取り扱い</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">6章Rによる時系列の取り扱い</h1>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># パッケージのインポート</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span></code></pre></div>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;ggfortify&#39;:
##   method                 from    
##   autoplot.Arima         forecast
##   autoplot.acf           forecast
##   autoplot.ar            forecast
##   autoplot.bats          forecast
##   autoplot.decomposed.ts forecast
##   autoplot.ets           forecast
##   autoplot.forecast      forecast
##   autoplot.stl           forecast
##   autoplot.ts            forecast
##   fitted.ar              forecast
##   fortify.ts             forecast
##   residuals.ar           forecast</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>( <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>))</span></code></pre></div>
<div id="時系列データts型" class="section level4 hasAnchor" number="0.0.0.1">
<h4><span class="header-section-number">0.0.0.1</span> 6-12.時系列データts型<a href="#時系列データts型" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>開始時点と「1年に何回データが取られるか」という頻度を指定</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2000年1月から月単位で36個を格納</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ts_sample <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ts_sample</span></code></pre></div>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 2000   1   2   3   4   5   6   7   8   9  10  11  12
## 2001  13  14  15  16  17  18  19  20  21  22  23  24
## 2002  25  26  27  28  29  30  31  32  33  34  35  36</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 四半期の場合</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ts_freq4 <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ts_freq4</span></code></pre></div>
<pre><code>##      Qtr1 Qtr2 Qtr3 Qtr4
## 2000    1    4    7    3
## 2001    9    2    5    3</code></pre>
<ul>
<li>多変量時系列データを作成する場合は、matrix型やdata.frame型のデータを引数に入れる。</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列の作成</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mat_with_name <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> T,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;row1&quot;</span>,<span class="st">&quot;row2&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;col1&quot;</span>, <span class="st">&quot;col2&quot;</span>, <span class="st">&quot;col3&quot;</span>, <span class="st">&quot;col4&quot;</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 作成した行列を用いて、ts型に変換</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>ts_multi <span class="ot">&lt;-</span> <span class="fu">ts</span>(mat_with_name, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ts_multi</span></code></pre></div>
<pre><code>##          col1 col2 col3 col4
## Jan 2000    1    2    3    4
## Feb 2000    5    6    7    8</code></pre>
<ul>
<li>作成したts型のデータに対して、window関数を用いることで、特定の期間を抽出可能</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">window</span>(ts_freq4, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##      Qtr1 Qtr2 Qtr3 Qtr4
## 2000         4    7    3
## 2001    9</code></pre>
<ul>
<li>RにはPython同様、様々なサンプルデータが用意されている。</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># シートベルト法案の有無と交通事故死傷者数の時系列推移</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Seatbelts[,], <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##          DriversKilled drivers front rear  kms PetrolPrice VanKilled law
## Jan 1969           107    1687   867  269 9059   0.1029718        12   0
## Feb 1969            97    1508   825  265 7685   0.1023630         6   0
## Mar 1969           102    1507   806  319 9963   0.1020625        12   0</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 多変量の場合、[]で特定の列を抽出</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Seatbelts[, <span class="st">&quot;front&quot;</span>]</span></code></pre></div>
<pre><code>##       Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec
## 1969  867  825  806  814  991  945 1004 1091  958  850 1109 1113
## 1970  925  903 1006  892  990  866 1095 1204 1029 1147 1171 1299
## 1971  944  874  840  893 1007  973 1097 1194  988 1077 1045 1115
## 1972 1005  857  879  887 1075 1121 1190 1058  939 1074 1089 1208
## 1973  903  916  787 1114 1014 1022 1114 1132 1111 1008  916  992
## 1974  731  665  724  744  910  883  900 1057 1076  919  920  953
## 1975  664  607  777  633  791  790  803  884  769  732  859  994
## 1976  704  684  671  643  771  644  828  748  767  825  810  986
## 1977  714  567  616  678  742  840  888  852  774  831  889 1046
## 1978  889  626  808  746  754  865  980  959  856  798  942 1010
## 1979  796  643  794  750  809  716  851  931  834  762  880 1077
## 1980  748  593  720  646  765  820  807  885  803  860  825  911
## 1981  704  691  688  714  814  736  876  829  818  942  782  823
## 1982  595  673  660  676  755  815  867  933  798  950  825  911
## 1983  619  426  475  556  559  483  587  615  618  662  519  585
## 1984  483  434  513  548  586  522  601  644  643  641  711  721</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ベクトルを用いて、複数列の抽出</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>Seatbelts[, <span class="fu">c</span>(<span class="st">&quot;front&quot;</span>, <span class="st">&quot;PetrolPrice&quot;</span>)]</span></code></pre></div>
<pre><code>##          front PetrolPrice
## Jan 1969   867  0.10297181
## Feb 1969   825  0.10236300
## Mar 1969   806  0.10206249
## Apr 1969   814  0.10087330
## May 1969   991  0.10101967
## Jun 1969   945  0.10058119
## Jul 1969  1004  0.10377398
## Aug 1969  1091  0.10407640
## Sep 1969   958  0.10377398
## Oct 1969   850  0.10302640
## Nov 1969  1109  0.10273011
## Dec 1969  1113  0.10199719
## Jan 1970   925  0.10127456
## Feb 1970   903  0.10070398
## Mar 1970  1006  0.10013961
## Apr 1970   892  0.09862110
## May 1970   990  0.09834929
## Jun 1970   866  0.09808018
## Jul 1970  1095  0.09727921
## Aug 1970  1204  0.09741062
## Sep 1970  1029  0.09742524
## Oct 1970  1147  0.09638063
## Nov 1970  1171  0.09573896
## Dec 1970  1299  0.09510631
## Jan 1971   944  0.09673597
## Feb 1971   874  0.09610922
## Mar 1971   840  0.09536725
## Apr 1971   893  0.09470959
## May 1971  1007  0.09411762
## Jun 1971   973  0.09353215
## Jul 1971  1097  0.09295405
## Aug 1971  1194  0.09283979
## Sep 1971   988  0.09272474
## Oct 1971  1077  0.09226965
## Nov 1971  1045  0.09170669
## Dec 1971  1115  0.09126207
## Jan 1972  1005  0.09071160
## Feb 1972   857  0.09027633
## Mar 1972   879  0.08995192
## Apr 1972   887  0.08909964
## May 1972  1075  0.08867919
## Jun 1972  1121  0.08815929
## Jul 1972  1190  0.08890206
## Aug 1972  1058  0.08818133
## Sep 1972   939  0.08894029
## Oct 1972  1074  0.08772661
## Nov 1972  1089  0.08742885
## Dec 1972  1208  0.08703543
## Jan 1973   903  0.08644992
## Feb 1973   916  0.08587264
## Mar 1973   787  0.08539822
## Apr 1973  1114  0.08382198
## May 1973  1014  0.08459078
## Jun 1973  1022  0.08413690
## Jul 1973  1114  0.08377841
## Aug 1973  1132  0.08351074
## Sep 1973  1111  0.08280639
## Oct 1973  1008  0.08117889
## Nov 1973   916  0.08285361
## Dec 1973   992  0.09419012
## Jan 1974   731  0.09239984
## Feb 1974   665  0.10816148
## Mar 1974   724  0.10721169
## Apr 1974   744  0.11404297
## May 1974   910  0.11245412
## Jun 1974   883  0.11131625
## Jul 1974   900  0.11030125
## Aug 1974  1057  0.10819718
## Sep 1974  1076  0.10702744
## Oct 1974   919  0.10494698
## Nov 1974   920  0.11935775
## Dec 1974   953  0.11762190
## Jan 1975   664  0.13302742
## Feb 1975   607  0.13084524
## Mar 1975   777  0.12831848
## Apr 1975   633  0.12354745
## May 1975   791  0.11858681
## Jun 1975   790  0.11633748
## Jul 1975   803  0.11516148
## Aug 1975   884  0.11450120
## Sep 1975   769  0.11352298
## Oct 1975   732  0.11193018
## Nov 1975   859  0.11061053
## Dec 1975   994  0.11527439
## Jan 1976   704  0.11379349
## Feb 1976   684  0.11234958
## Mar 1976   671  0.11175347
## Apr 1976   643  0.10964252
## May 1976   771  0.10844090
## Jun 1976   644  0.10788494
## Jul 1976   828  0.10908477
## Aug 1976   748  0.10757145
## Sep 1976   767  0.10616402
## Oct 1976   825  0.10630000
## Nov 1976   810  0.10482531
## Dec 1976   986  0.10345175
## Jan 1977   714  0.10144992
## Feb 1977   567  0.10040232
## Mar 1977   616  0.09886203
## Apr 1977   678  0.10249615
## May 1977   742  0.10302743
## Jun 1977   840  0.10217891
## Jul 1977   888  0.09983664
## Aug 1977   852  0.09263669
## Sep 1977   774  0.09181496
## Oct 1977   831  0.09072430
## Nov 1977   889  0.09002121
## Dec 1977  1046  0.08933071
## Jan 1978   889  0.08844273
## Feb 1978   626  0.08835257
## Mar 1978   808  0.08675736
## Apr 1978   746  0.08499524
## May 1978   754  0.08456794
## Jun 1978   865  0.08443190
## Jul 1978   980  0.08435088
## Aug 1978   959  0.08360098
## Sep 1978   856  0.08341726
## Oct 1978   798  0.08274514
## Nov 1978   942  0.08523527
## Dec 1978  1010  0.08477030
## Jan 1979   796  0.08445892
## Feb 1979   643  0.08535212
## Mar 1979   794  0.08755921
## Apr 1979   750  0.09038292
## May 1979   809  0.09078329
## Jun 1979   716  0.10874278
## Jul 1979   851  0.11414223
## Aug 1979   931  0.11299293
## Sep 1979   834  0.11132071
## Oct 1979   762  0.10912623
## Nov 1979   880  0.10769846
## Dec 1979  1077  0.10760157
## Jan 1980   748  0.10377502
## Feb 1980   593  0.10711417
## Mar 1980   720  0.10737477
## Apr 1980   646  0.11169537
## May 1980   765  0.11063818
## Jun 1980   820  0.11185521
## Jul 1980   807  0.10974234
## Aug 1980   885  0.10819393
## Sep 1980   803  0.10625536
## Oct 1980   860  0.10419303
## Nov 1980   825  0.10193397
## Dec 1980   911  0.10279382
## Jan 1981   704  0.10476034
## Feb 1981   691  0.10400254
## Mar 1981   688  0.11665552
## Apr 1981   714  0.11516148
## May 1981   814  0.11298954
## Jun 1981   736  0.11386064
## Jul 1981   876  0.11911808
## Aug 1981   829  0.12448999
## Sep 1981   818  0.12322295
## Oct 1981   942  0.12067793
## Nov 1981   782  0.12104898
## Dec 1981   823  0.11696857
## Jan 1982   595  0.11275026
## Feb 1982   673  0.10807931
## Mar 1982   660  0.10883852
## Apr 1982   676  0.11129177
## May 1982   755  0.11130401
## Jun 1982   815  0.11545436
## Jul 1982   867  0.11476830
## Aug 1982   933  0.11720743
## Sep 1982   798  0.11907640
## Oct 1982   950  0.11796586
## Nov 1982   825  0.11744913
## Dec 1982   911  0.11698846
## Jan 1983   619  0.11261054
## Feb 1983   426  0.11365702
## Mar 1983   475  0.11314445
## Apr 1983   556  0.11849553
## May 1983   559  0.11796940
## Jun 1983   483  0.11768661
## Jul 1983   587  0.12005924
## Aug 1983   615  0.11943775
## Sep 1983   618  0.11888127
## Oct 1983   662  0.11846236
## Nov 1983   519  0.11801660
## Dec 1983   585  0.11770662
## Jan 1984   483  0.11777609
## Feb 1984   434  0.11479699
## Mar 1984   513  0.11573525
## Apr 1984   548  0.11535626
## May 1984   586  0.11481536
## Jun 1984   522  0.11477748
## Jul 1984   601  0.11493598
## Aug 1984   644  0.11479699
## Sep 1984   643  0.11409316
## Oct 1984   641  0.11646552
## Nov 1984   711  0.11602611
## Dec 1984   721  0.11606673</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset関数で特定の月のみを抽出(forecastに内包)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(Seatbelts[, <span class="st">&quot;front&quot;</span>], <span class="at">month =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1969.167 
## End = 1984.167 
## Frequency = 1 
##  [1]  806 1006  840  879  787  724  777  671  616  808  794  720  688  660  475
## [16]  513</code></pre>
</div>
<div id="拡張された時系列データxts型" class="section level4 hasAnchor" number="0.0.0.2">
<h4><span class="header-section-number">0.0.0.2</span> 6-13.拡張された時系列データxts型<a href="#拡張された時系列データxts型" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>ts型は日単位に弱いという欠点がある。</li>
<li>その欠点を補うのにzoo等の時系列を取り扱う型が用意されており、それを統合したのがxtsである。</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行名として日付を指定したmatrix型データを引数に与える</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>xts_sample <span class="ot">&lt;-</span> <span class="fu">as.xts</span>(<span class="fu">matrix</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;2000-01-01&quot;</span>,<span class="st">&quot;2000-01-02&quot;</span>,<span class="st">&quot;2000-01-03&quot;</span>,<span class="st">&quot;2000-01-04&quot;</span>,<span class="st">&quot;2000-01-05&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>xts_sample</span></code></pre></div>
<pre><code>##            [,1]
## 2000-01-01    1
## 2000-01-02    2
## 2000-01-03    3
## 2000-01-04    4
## 2000-01-05    5</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># xts型はデータ抽出がとても簡単</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>xts_sample[<span class="st">&quot;2000-01-01&quot;</span>]</span></code></pre></div>
<pre><code>##            [,1]
## 2000-01-01    1</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ある日付以降</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>xts_sample[<span class="st">&quot;2000-01-02::&quot;</span>]</span></code></pre></div>
<pre><code>##            [,1]
## 2000-01-02    2
## 2000-01-03    3
## 2000-01-04    4
## 2000-01-05    5</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 範囲指定</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>xts_sample[<span class="st">&quot;2000-01-02::2000-01-04&quot;</span>]</span></code></pre></div>
<pre><code>##            [,1]
## 2000-01-02    2
## 2000-01-03    3
## 2000-01-04    4</code></pre>
</div>
<div id="ファイルデータの取り込み" class="section level4 hasAnchor" number="0.0.0.3">
<h4><span class="header-section-number">0.0.0.3</span> 6-14.ファイルデータの取り込み<a href="#ファイルデータの取り込み" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>ファイルからデータを読み込むと原則data.frame型で読み込まれる。</li>
<li>ts型は引数にdata.frame型を取れるためそのまま変換が可能</li>
<li>xts型はそうはいかず、少々工夫が必要になる。</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>file_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/5-2-1-timeSeries.csv&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>file_data</span></code></pre></div>
<pre><code>##         time data
## 1 2000-01-01    1
## 2 2000-01-02    2
## 3 2000-01-03    3
## 4 2000-01-04    4
## 5 2000-01-05    5</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ファイルのフルパスではなく、ファイル選択ダイアログを表示し、選択</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># file_data_2 &lt;- read.csv(file.choose())</span></span></code></pre></div>
<ul>
<li>read.delim(“clipboard”)を使うことで、Excel等でコピーした内容をそのまま取り込むことができる。</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(file_data)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<ul>
<li>xts型に変換するには、read.zoo()を用いるのが簡単</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1列目が時間のラベルになっている。</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>file_data_xts <span class="ot">&lt;-</span> <span class="fu">as.xts</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.zoo</span>(file_data)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>file_data_xts</span></code></pre></div>
<pre><code>##            [,1]
## 2000-01-01    1
## 2000-01-02    2
## 2000-01-03    3
## 2000-01-04    4
## 2000-01-05    5</code></pre>
</div>
<div id="グラフの描画" class="section level4 hasAnchor" number="0.0.0.4">
<h4><span class="header-section-number">0.0.0.4</span> 6-15.グラフの描画<a href="#グラフの描画" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  Seatbelts[, <span class="st">&quot;front&quot;</span>],</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;イギリスの交通事故死者数（前席）&quot;</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;年&quot;</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;死傷者数&quot;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="2-6_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># より見やすく</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  Seatbelts[, <span class="st">&quot;front&quot;</span>],</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;イギリスの交通事故死傷者数（前席）&quot;</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;年&quot;</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;死傷者数&quot;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="2-6_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="単位根検定" class="section level4 hasAnchor" number="0.0.0.5">
<h4><span class="header-section-number">0.0.0.5</span> 6-16.単位根検定<a href="#単位根検定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>urcaでkpss検定を実装</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数に変換しつつ、kpss検定</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">ur.kpss</span>(<span class="fu">log</span>(Seatbelts[, <span class="st">&quot;front&quot;</span>])))</span></code></pre></div>
<pre><code>## 
## ####################### 
## # KPSS Unit Root Test # 
## ####################### 
## 
## Test is of type: mu with 4 lags. 
## 
## Value of test-statistic is: 2.3004 
## 
## Critical value for a significance level of: 
##                 10pct  5pct 2.5pct  1pct
## critical values 0.347 0.463  0.574 0.739</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># forecastのndiffs関数を使うといくつ階差を取ればいいかがわかる</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">log</span>(Seatbelts[, <span class="st">&quot;front&quot;</span>]))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
